
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>11. Case Study: Debugging in Regression &#8212; MLOps</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'book/assignments/debugging-in-regression';</script>
    <link rel="canonical" href="https://aqwqqq.github.io/jupyter-mlops/book/assignments/debugging-in-regression.html" />
    <link rel="icon" href="../../_static/fav.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="12. Introduction" href="random-forest-classifier.html" />
    <link rel="prev" title="10. Case Study: Debugging in Classification" href="debugging-in-classification.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.jpg" class="logo__image only-light" alt="MLOps - Home"/>
    <script>document.write(`<img src="../../_static/logo.jpg" class="logo__image only-dark" alt="MLOps - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Chapters</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../problem-framing.html">2. Problem framing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-engineering.html">3. Data engineering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model-training-and-evaluation.html">4. Model training &amp; evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model-deployment.html">5. Model deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../markdown.html">6. Markdown Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks.html">7. Content with notebooks</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Assignments</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="data-engineering.html">8. Data engineering</a></li>
<li class="toctree-l1"><a class="reference internal" href="counterintuitive-challenges-in-ml-debugging.html">9. Counterintuitive Challenges in ML Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging-in-classification.html">10. Case Study: Debugging in Classification</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">11. Case Study: Debugging in Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="random-forest-classifier.html">12. Introduction</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/Aqwqqq/jupyter-mlops/master?urlpath=tree/book/assignments/debugging-in-regression.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/Aqwqqq/jupyter-mlops/blob/master/book/assignments/debugging-in-regression.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/Aqwqqq/jupyter-mlops" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/Aqwqqq/jupyter-mlops/edit/main/book/assignments/debugging-in-regression.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/Aqwqqq/jupyter-mlops/issues/new?title=Issue%20on%20page%20%2Fbook/assignments/debugging-in-regression.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/book/assignments/debugging-in-regression.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Case Study: Debugging in Regression</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">11.1. Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#check-correlation-matrix">11.2. Check Correlation Matrix</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#validate-input-data-against-data-schema">11.3. Validate Input Data against Data Schema</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#solution">11.3.1. Solution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#split-and-normalize-data">11.4. Split and Normalize Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-engineered-data">11.5. Test Engineered Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#check-splits-for-statistical-equivalence">11.6. Check Splits for Statistical Equivalence</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#establish-a-baseline">11.7. Establish a Baseline</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-model">11.8. Linear Model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hint">11.8.1. Hint</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">11.8.2. Solution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#add-feature-to-linear-model">11.9. Add Feature to Linear Model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">11.9.1. Solution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-a-nonlinear-model">11.10. Use a Nonlinear Model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">11.10.1. Solution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optimize-your-model">11.11. Optimize Your Model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">11.11.1. Hint</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">11.11.2. Solution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#check-for-implementation-bugs-using-reduced-dataset">11.12. Check for Implementation Bugs using Reduced Dataset</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">11.12.1. Solution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#trying-a-very-complex-model">11.13. Trying a Very Complex Model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#results">11.13.1. Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">11.14. Conclusion</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <details><summary><b>LICENSE</b></summary>
<p>Copyright 2018 Google LLC.</p>
<p>Licensed under the Apache License, Version 2.0 (the “License”);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>
<p><a class="reference external" href="https://www.apache.org/licenses/LICENSE-2.0">https://www.apache.org/licenses/LICENSE-2.0</a></p>
<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an “AS IS” BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p>
</details><section class="tex2jax_ignore mathjax_ignore" id="case-study-debugging-in-regression">
<h1><span class="section-number">11. </span>Case Study: Debugging in Regression<a class="headerlink" href="#case-study-debugging-in-regression" title="Link to this heading">#</a></h1>
<p>In this Colab, you will learn how to debug a regression problem through a case study. You will:</p>
<ol class="arabic simple">
<li><p>Set up the problem.</p></li>
<li><p>Interpret the correlation matrix.</p></li>
<li><p>Implement linear and nonlinear models.</p></li>
<li><p>Compare and choose between linear and nonlinear models.</p></li>
<li><p>Optimize your chosen model.</p></li>
<li><p>Debug your chosen model.</p></li>
</ol>
<section id="setup">
<h2><span class="section-number">11.1. </span>Setup<a class="headerlink" href="#setup" title="Link to this heading">#</a></h2>
<p>This Colab uses the wine quality dataset&lt;sup#[1]&lt;/sup#, which is hosted at <a class="reference external" href="https://archive.ics.uci.edu/ml/datasets/wine+quality">UCI</a>. This dataset contains data on the physicochemical properties of wine along with wine quality ratings. The problem is to predict wine quality (0-10) from physicochemical properties.</p>
<p>Please <strong>make a copy</strong> of this Colab before running it. Click on <em>File</em>, and then click on <em>Save a copy in Drive</em>.</p>
<p>&lt;small#[1] Modeling wine preferences by data mining from physicochemical properties. P. Cortez, A. Cerdeira, F. Almeida, T. Matos and J. Reis. Decision Support Systems, Elsevier, 47(4):547-553, 2009.&lt;/small#</p>
<p>Load libraries and data by running the next cell. Display the first few rows to verify that the dataset loaded correctly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reset environment for a new run</span>
<span class="o">%</span><span class="k">reset</span> -f

<span class="c1"># Load libraries</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span> <span class="c1"># for joining file pathnames</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Set Pandas display options</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">max_rows</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span>

<span class="n">wineDf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
  <span class="s2">&quot;https://static-1300131294.cos.ap-shanghai.myqcloud.com/data/winequality.csv&quot;</span><span class="p">,</span>
  <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;latin-1&#39;</span><span class="p">)</span>
<span class="n">wineDf</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;fixed acidity&#39;</span><span class="p">,</span><span class="s1">&#39;volatile acidity&#39;</span><span class="p">,</span><span class="s1">&#39;citric acid&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;residual sugar&#39;</span><span class="p">,</span><span class="s1">&#39;chlorides&#39;</span><span class="p">,</span><span class="s1">&#39;free sulfur dioxide&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;total sulfur dioxide&#39;</span><span class="p">,</span><span class="s1">&#39;density&#39;</span><span class="p">,</span><span class="s1">&#39;pH&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;sulphates&#39;</span><span class="p">,</span><span class="s1">&#39;alcohol&#39;</span><span class="p">,</span><span class="s1">&#39;quality&#39;</span><span class="p">]</span>
<span class="n">wineDf</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-7254ca3b-ab43-4413-a67c-556f14b7b130" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fixed acidity</th>
      <th>volatile acidity</th>
      <th>citric acid</th>
      <th>residual sugar</th>
      <th>chlorides</th>
      <th>free sulfur dioxide</th>
      <th>total sulfur dioxide</th>
      <th>density</th>
      <th>pH</th>
      <th>sulphates</th>
      <th>alcohol</th>
      <th>quality</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7.0</td>
      <td>0.3</td>
      <td>0.4</td>
      <td>20.7</td>
      <td>0.0</td>
      <td>45.0</td>
      <td>170.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>0.5</td>
      <td>8.8</td>
      <td>6</td>
    </tr>
    <tr>
      <th>1</th>
      <td>6.3</td>
      <td>0.3</td>
      <td>0.3</td>
      <td>1.6</td>
      <td>0.0</td>
      <td>14.0</td>
      <td>132.0</td>
      <td>1.0</td>
      <td>3.3</td>
      <td>0.5</td>
      <td>9.5</td>
      <td>6</td>
    </tr>
    <tr>
      <th>2</th>
      <td>8.1</td>
      <td>0.3</td>
      <td>0.4</td>
      <td>6.9</td>
      <td>0.1</td>
      <td>30.0</td>
      <td>97.0</td>
      <td>1.0</td>
      <td>3.3</td>
      <td>0.4</td>
      <td>10.1</td>
      <td>6</td>
    </tr>
    <tr>
      <th>3</th>
      <td>7.2</td>
      <td>0.2</td>
      <td>0.3</td>
      <td>8.5</td>
      <td>0.1</td>
      <td>47.0</td>
      <td>186.0</td>
      <td>1.0</td>
      <td>3.2</td>
      <td>0.4</td>
      <td>9.9</td>
      <td>6</td>
    </tr>
    <tr>
      <th>4</th>
      <td>7.2</td>
      <td>0.2</td>
      <td>0.3</td>
      <td>8.5</td>
      <td>0.1</td>
      <td>47.0</td>
      <td>186.0</td>
      <td>1.0</td>
      <td>3.2</td>
      <td>0.4</td>
      <td>9.9</td>
      <td>6</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-7254ca3b-ab43-4413-a67c-556f14b7b130')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-7254ca3b-ab43-4413-a67c-556f14b7b130 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-7254ca3b-ab43-4413-a67c-556f14b7b130');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-f0e3d442-6c63-428c-9ffa-b832d77d20af">
  <button class="colab-df-quickchart" onclick="quickchart('df-f0e3d442-6c63-428c-9ffa-b832d77d20af')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-f0e3d442-6c63-428c-9ffa-b832d77d20af button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>
</div></div>
</div>
</section>
<section id="check-correlation-matrix">
<h2><span class="section-number">11.2. </span>Check Correlation Matrix<a class="headerlink" href="#check-correlation-matrix" title="Link to this heading">#</a></h2>
<p>Before developing your ML model, you need to select features. To find informative features, check the correlation matrix by running the following cell. Which features are informative?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_wineDf</span> <span class="o">=</span> <span class="n">wineDf</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr_wineDf</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: &gt;
</pre></div>
</div>
<img alt="../../_images/0be573dc5c8eb1075a9339c69e6e8e77a779eb513f8f6797532c6cd83b214cb0.png" src="../../_images/0be573dc5c8eb1075a9339c69e6e8e77a779eb513f8f6797532c6cd83b214cb0.png" />
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">alcohol</span></code> is most highly correlated with <code class="docutils literal notranslate"><span class="pre">quality</span></code>. Looking for other informative features, notice that <code class="docutils literal notranslate"><span class="pre">volatile</span> <span class="pre">acidity</span></code> correlates with <code class="docutils literal notranslate"><span class="pre">quality</span></code> but not with <code class="docutils literal notranslate"><span class="pre">alcohol</span></code>, making it a good second feature. Remember that a correlation matrix is not helpful if predictive signals are encoded in combinations of features.</p>
</section>
<section id="validate-input-data-against-data-schema">
<h2><span class="section-number">11.3. </span>Validate Input Data against Data Schema<a class="headerlink" href="#validate-input-data-against-data-schema" title="Link to this heading">#</a></h2>
<p>Before processing your data, you should validate the data against a data schema as described in <a class="reference external" href="https://developers.google.com/machine-learning/testing-debugging/common/data-errors">Data and Feature Debugging</a>.</p>
<p>First, define a function that validates data against a schema.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title Define function to validate data</span>

<span class="k">def</span> <span class="nf">test_data_schema</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;Tests that the datatypes and ranges of values in the dataset</span>
<span class="sd">    adhere to expectations.</span>

<span class="sd">    Args:</span>
<span class="sd">      input_function: Dataframe containing data to test</span>
<span class="sd">      schema: Schema which describes the properties of the data.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">test_dtypes</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="k">assert</span> <span class="n">input_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span>
          <span class="n">schema</span><span class="p">[</span><span class="n">column</span><span class="p">][</span><span class="s1">&#39;dtype&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="p">(</span>
          <span class="s2">&quot;Incorrect dtype in column &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span> <span class="o">%</span> <span class="n">column</span>
      <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Input dtypes are correct.&#39;</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">test_ranges</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="n">schema_max</span> <span class="o">=</span> <span class="n">schema</span><span class="p">[</span><span class="n">column</span><span class="p">][</span><span class="s1">&#39;range&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">]</span>
      <span class="n">schema_min</span> <span class="o">=</span> <span class="n">schema</span><span class="p">[</span><span class="n">column</span><span class="p">][</span><span class="s1">&#39;range&#39;</span><span class="p">][</span><span class="s1">&#39;min&#39;</span><span class="p">]</span>
      <span class="c1"># Assert that data falls between schema min and max.</span>
      <span class="k">assert</span> <span class="n">input_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">schema_max</span><span class="p">,</span> <span class="p">(</span>
          <span class="s2">&quot;Maximum value of column &#39;</span><span class="si">%s</span><span class="s2">&#39; is too low.&quot;</span> <span class="o">%</span> <span class="n">column</span>
      <span class="p">)</span>
      <span class="k">assert</span> <span class="n">input_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">schema_min</span><span class="p">,</span> <span class="p">(</span>
          <span class="s2">&quot;Minimum value of column &#39;</span><span class="si">%s</span><span class="s2">&#39; is too high.&quot;</span> <span class="o">%</span> <span class="n">column</span>
      <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Data falls within specified ranges.&#39;</span><span class="p">)</span>

  <span class="n">test_dtypes</span><span class="p">()</span>
  <span class="n">test_ranges</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>To define your schema, you need to understand the statistical properties of your dataset. Generate statistics on your dataset by running the following code cell:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wineDf</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-b2ab9d8a-6ba5-4728-b41e-46e0c2adc191" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fixed acidity</th>
      <th>volatile acidity</th>
      <th>citric acid</th>
      <th>residual sugar</th>
      <th>chlorides</th>
      <th>free sulfur dioxide</th>
      <th>total sulfur dioxide</th>
      <th>density</th>
      <th>pH</th>
      <th>sulphates</th>
      <th>alcohol</th>
      <th>quality</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>6497.0</td>
      <td>6497.0</td>
      <td>6497.0</td>
      <td>6497.0</td>
      <td>6497.0</td>
      <td>6497.0</td>
      <td>6497.0</td>
      <td>6497.0</td>
      <td>6497.0</td>
      <td>6497.0</td>
      <td>6497.0</td>
      <td>6497.0</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>7.2</td>
      <td>0.3</td>
      <td>0.3</td>
      <td>5.4</td>
      <td>0.1</td>
      <td>30.5</td>
      <td>115.7</td>
      <td>1.0</td>
      <td>3.2</td>
      <td>0.5</td>
      <td>10.5</td>
      <td>5.8</td>
    </tr>
    <tr>
      <th>std</th>
      <td>1.3</td>
      <td>0.2</td>
      <td>0.1</td>
      <td>4.8</td>
      <td>0.0</td>
      <td>17.7</td>
      <td>56.5</td>
      <td>0.0</td>
      <td>0.2</td>
      <td>0.1</td>
      <td>1.2</td>
      <td>0.9</td>
    </tr>
    <tr>
      <th>min</th>
      <td>3.8</td>
      <td>0.1</td>
      <td>0.0</td>
      <td>0.6</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>6.0</td>
      <td>1.0</td>
      <td>2.7</td>
      <td>0.2</td>
      <td>8.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>6.4</td>
      <td>0.2</td>
      <td>0.2</td>
      <td>1.8</td>
      <td>0.0</td>
      <td>17.0</td>
      <td>77.0</td>
      <td>1.0</td>
      <td>3.1</td>
      <td>0.4</td>
      <td>9.5</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>7.0</td>
      <td>0.3</td>
      <td>0.3</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>29.0</td>
      <td>118.0</td>
      <td>1.0</td>
      <td>3.2</td>
      <td>0.5</td>
      <td>10.3</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>7.7</td>
      <td>0.4</td>
      <td>0.4</td>
      <td>8.1</td>
      <td>0.1</td>
      <td>41.0</td>
      <td>156.0</td>
      <td>1.0</td>
      <td>3.3</td>
      <td>0.6</td>
      <td>11.3</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>max</th>
      <td>15.9</td>
      <td>1.6</td>
      <td>1.7</td>
      <td>65.8</td>
      <td>0.6</td>
      <td>289.0</td>
      <td>440.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>14.9</td>
      <td>9.0</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-b2ab9d8a-6ba5-4728-b41e-46e0c2adc191')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-b2ab9d8a-6ba5-4728-b41e-46e0c2adc191 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-b2ab9d8a-6ba5-4728-b41e-46e0c2adc191');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-4eef1f73-c9c0-4bf4-a96c-f477103eee15">
  <button class="colab-df-quickchart" onclick="quickchart('df-4eef1f73-c9c0-4bf4-a96c-f477103eee15')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-4eef1f73-c9c0-4bf4-a96c-f477103eee15 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>
</div></div>
</div>
<p>Using the statistics generated above, define the data schema in the following code cell. For demonstration purposes, restrict your data schema to the first three data columns. For each data column, enter the:</p>
<ul class="simple">
<li><p>minimum value</p></li>
<li><p>maximum value</p></li>
<li><p>data type</p></li>
</ul>
<p>As an example, the values for the first column are filled out. After entering the values, run the code cell to confirm that your input data matches the schema.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wine_schema</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;fixed acidity&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mf">3.8</span><span class="p">,</span>
            <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mf">15.9</span>
        <span class="p">},</span>
        <span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s1">&#39;volatile acidity&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.08</span><span class="p">,</span>  <span class="c1"># Placeholder value, update with the actual minimum</span>
            <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mf">1.58</span>  <span class="c1"># Placeholder value, update with the actual maximum</span>
        <span class="p">},</span>
        <span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>  <span class="c1"># Placeholder value, update with the actual dtype</span>
    <span class="p">},</span>
    <span class="s1">&#39;citric acid&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># Placeholder value, update with the actual minimum</span>
            <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mf">1.66</span>  <span class="c1"># Placeholder value, update with the actual maximum</span>
        <span class="p">},</span>
        <span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>  <span class="c1"># Placeholder value, update with the actual dtype</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Validating wine data against data schema...&#39;</span><span class="p">)</span>
<span class="n">test_data_schema</span><span class="p">(</span><span class="n">wineDf</span><span class="p">,</span> <span class="n">wine_schema</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Validating wine data against data schema...
Input dtypes are correct.
Data falls within specified ranges.
</pre></div>
</div>
</div>
</div>
<section id="solution">
<h3><span class="section-number">11.3.1. </span>Solution<a class="headerlink" href="#solution" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wine_schema</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;fixed acidity&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mf">3.7</span><span class="p">,</span>
            <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mf">15.9</span>
        <span class="p">},</span>
        <span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s1">&#39;volatile acidity&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.08</span><span class="p">,</span>  <span class="c1"># minimum value</span>
            <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mf">1.6</span>   <span class="c1"># maximum value</span>
        <span class="p">},</span>
        <span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>    <span class="c1"># data type</span>
    <span class="p">},</span>
    <span class="s1">&#39;citric acid&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="c1"># minimum value</span>
            <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mf">1.7</span>  <span class="c1"># maximum value</span>
        <span class="p">},</span>
        <span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>   <span class="c1"># data type</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Validating wine data against data schema...&#39;</span><span class="p">)</span>
<span class="n">test_data_schema</span><span class="p">(</span><span class="n">wineDf</span><span class="p">,</span> <span class="n">wine_schema</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Validating wine data against data schema...
Input dtypes are correct.
Data falls within specified ranges.
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="split-and-normalize-data">
<h2><span class="section-number">11.4. </span>Split and Normalize Data<a class="headerlink" href="#split-and-normalize-data" title="Link to this heading">#</a></h2>
<p>Split the dataset into data and labels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wineFeatures</span> <span class="o">=</span> <span class="n">wineDf</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">wineFeatures</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;quality&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">wineLabels</span> <span class="o">=</span> <span class="n">wineDf</span><span class="p">[</span><span class="s1">&#39;quality&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Normalize data using z-score.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">normalizeData</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
  <span class="n">stdArr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
  <span class="n">meanArr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
  <span class="n">arr</span> <span class="o">=</span> <span class="p">(</span><span class="n">arr</span><span class="o">-</span><span class="n">meanArr</span><span class="p">)</span><span class="o">/</span><span class="n">stdArr</span>
  <span class="k">return</span> <span class="n">arr</span>

<span class="k">for</span> <span class="n">str1</span> <span class="ow">in</span> <span class="n">wineFeatures</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
   <span class="n">wineFeatures</span><span class="p">[</span><span class="n">str1</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalizeData</span><span class="p">(</span><span class="n">wineFeatures</span><span class="p">[</span><span class="n">str1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="test-engineered-data">
<h2><span class="section-number">11.5. </span>Test Engineered Data<a class="headerlink" href="#test-engineered-data" title="Link to this heading">#</a></h2>
<p>After normalizing your data, you should test your engineered data for errors as described in <a class="reference external" href="https://developers.google.com/machine-learning/testing-debugging/common/data-errors">Data and Feature Debugging</a>. In this section, you will test that engineering data:</p>
<ul class="simple">
<li><p>Has the expected number of rows and columns.</p></li>
<li><p>Does not have null values.</p></li>
</ul>
<p>First, set up the testing functions by running the following code cell:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unittest</span>

<span class="k">def</span> <span class="nf">test_input_dim</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">n_rows</span><span class="p">,</span> <span class="n">n_columns</span><span class="p">):</span>
  <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">==</span> <span class="n">n_rows</span><span class="p">,</span> <span class="s2">&quot;Unexpected number of rows.&quot;</span>
  <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="n">n_columns</span><span class="p">,</span> <span class="s2">&quot;Unexpected number of columns.&quot;</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Engineered data has the expected number of rows and columns.&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_nulls</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
  <span class="n">dataNulls</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
  <span class="k">assert</span> <span class="n">dataNulls</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Nulls in engineered data.&quot;</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Engineered features do not contain nulls.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Your input data had 6497 examples and 11 feature columns. Test whether your engineered data has the expected number of rows and columns by running the following cell. Confirm that the test fails if you change the values below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title Test dimensions of engineered data</span>
<span class="n">wine_feature_rows</span> <span class="o">=</span> <span class="mi">6497</span> <span class="c1">#@param</span>
<span class="n">wine_feature_cols</span> <span class="o">=</span> <span class="mi">11</span> <span class="c1">#@param</span>
<span class="n">test_input_dim</span><span class="p">(</span><span class="n">wineFeatures</span><span class="p">,</span>
               <span class="n">wine_feature_rows</span><span class="p">,</span>
               <span class="n">wine_feature_cols</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Engineered data has the expected number of rows and columns.
</pre></div>
</div>
</div>
</div>
<p>Test that your engineered data does not contain nulls by running the code below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_nulls</span><span class="p">(</span><span class="n">wineFeatures</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Engineered features do not contain nulls.
</pre></div>
</div>
</div>
</div>
</section>
<section id="check-splits-for-statistical-equivalence">
<h2><span class="section-number">11.6. </span>Check Splits for Statistical Equivalence<a class="headerlink" href="#check-splits-for-statistical-equivalence" title="Link to this heading">#</a></h2>
<p>As described in the <a class="reference external" href="https://developers.google.com/machine-learning/testing-debugging/common/data-errors">Data Debugging</a> guidelines, before developing your model, you should check that your training and validation splits are equally representative. Assuming a training:validation split of 80:20, compare the mean and the standard deviation of the splits by running the next two code cells. Note that this comparison is not a rigorous test for statistical equivalence but simply a quick and dirty comparison of the splits.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">splitIdx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">wineFeatures</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">wineFeatures</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">splitIdx</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-18844894-c647-41e9-a703-5aecfa2a3961" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fixed acidity</th>
      <th>volatile acidity</th>
      <th>citric acid</th>
      <th>residual sugar</th>
      <th>chlorides</th>
      <th>free sulfur dioxide</th>
      <th>total sulfur dioxide</th>
      <th>density</th>
      <th>pH</th>
      <th>sulphates</th>
      <th>alcohol</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>5197.0</td>
      <td>5197.0</td>
      <td>5197.0</td>
      <td>5197.0</td>
      <td>5197.0</td>
      <td>5197.0</td>
      <td>5197.0</td>
      <td>5197.0</td>
      <td>5197.0</td>
      <td>5197.0</td>
      <td>5197.0</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>-0.2</td>
      <td>-0.3</td>
      <td>0.1</td>
      <td>0.2</td>
      <td>-0.2</td>
      <td>0.2</td>
      <td>0.3</td>
      <td>-0.2</td>
      <td>-0.1</td>
      <td>-0.2</td>
      <td>-0.0</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.7</td>
      <td>0.8</td>
      <td>0.9</td>
      <td>1.1</td>
      <td>0.9</td>
      <td>1.0</td>
      <td>0.8</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.9</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-2.6</td>
      <td>-1.6</td>
      <td>-2.2</td>
      <td>-1.0</td>
      <td>-1.3</td>
      <td>-1.6</td>
      <td>-1.9</td>
      <td>-2.5</td>
      <td>-3.1</td>
      <td>-2.1</td>
      <td>-2.1</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>-0.7</td>
      <td>-0.8</td>
      <td>-0.4</td>
      <td>-0.8</td>
      <td>-0.6</td>
      <td>-0.5</td>
      <td>-0.2</td>
      <td>-1.0</td>
      <td>-0.8</td>
      <td>-0.8</td>
      <td>-0.9</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>-0.3</td>
      <td>-0.4</td>
      <td>-0.1</td>
      <td>-0.1</td>
      <td>-0.3</td>
      <td>0.1</td>
      <td>0.3</td>
      <td>-0.2</td>
      <td>-0.2</td>
      <td>-0.3</td>
      <td>-0.2</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.1</td>
      <td>0.0</td>
      <td>0.5</td>
      <td>0.9</td>
      <td>-0.1</td>
      <td>0.8</td>
      <td>0.9</td>
      <td>0.6</td>
      <td>0.4</td>
      <td>0.2</td>
      <td>0.7</td>
    </tr>
    <tr>
      <th>max</th>
      <td>6.0</td>
      <td>6.0</td>
      <td>9.2</td>
      <td>12.7</td>
      <td>15.8</td>
      <td>14.6</td>
      <td>5.7</td>
      <td>14.8</td>
      <td>4.2</td>
      <td>9.9</td>
      <td>3.1</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-18844894-c647-41e9-a703-5aecfa2a3961')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-18844894-c647-41e9-a703-5aecfa2a3961 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-18844894-c647-41e9-a703-5aecfa2a3961');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-0d0e69b0-eb45-4849-a959-8ba7ea04d92e">
  <button class="colab-df-quickchart" onclick="quickchart('df-0d0e69b0-eb45-4849-a959-8ba7ea04d92e')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-0d0e69b0-eb45-4849-a959-8ba7ea04d92e button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wineFeatures</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">splitIdx</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-be2e5d9a-a4de-472c-8e38-a7248c891d28" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fixed acidity</th>
      <th>volatile acidity</th>
      <th>citric acid</th>
      <th>residual sugar</th>
      <th>chlorides</th>
      <th>free sulfur dioxide</th>
      <th>total sulfur dioxide</th>
      <th>density</th>
      <th>pH</th>
      <th>sulphates</th>
      <th>alcohol</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1299.0</td>
      <td>1299.0</td>
      <td>1299.0</td>
      <td>1299.0</td>
      <td>1299.0</td>
      <td>1299.0</td>
      <td>1299.0</td>
      <td>1299.0</td>
      <td>1299.0</td>
      <td>1299.0</td>
      <td>1299.0</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.9</td>
      <td>1.1</td>
      <td>-0.3</td>
      <td>-0.6</td>
      <td>0.8</td>
      <td>-0.8</td>
      <td>-1.3</td>
      <td>0.7</td>
      <td>0.6</td>
      <td>0.8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>std</th>
      <td>1.4</td>
      <td>1.1</td>
      <td>1.3</td>
      <td>0.3</td>
      <td>1.1</td>
      <td>0.6</td>
      <td>0.6</td>
      <td>0.7</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.9</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-1.8</td>
      <td>-1.3</td>
      <td>-2.2</td>
      <td>-1.0</td>
      <td>-1.3</td>
      <td>-1.7</td>
      <td>-1.9</td>
      <td>-1.5</td>
      <td>-2.2</td>
      <td>-1.1</td>
      <td>-1.8</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>-0.1</td>
      <td>0.3</td>
      <td>-1.5</td>
      <td>-0.7</td>
      <td>0.4</td>
      <td>-1.3</td>
      <td>-1.7</td>
      <td>0.3</td>
      <td>-0.1</td>
      <td>0.1</td>
      <td>-0.7</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.6</td>
      <td>1.0</td>
      <td>-0.3</td>
      <td>-0.7</td>
      <td>0.7</td>
      <td>-0.9</td>
      <td>-1.4</td>
      <td>0.7</td>
      <td>0.5</td>
      <td>0.6</td>
      <td>-0.1</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>1.7</td>
      <td>1.8</td>
      <td>0.8</td>
      <td>-0.6</td>
      <td>1.0</td>
      <td>-0.5</td>
      <td>-1.0</td>
      <td>1.1</td>
      <td>1.1</td>
      <td>1.3</td>
      <td>0.7</td>
    </tr>
    <tr>
      <th>max</th>
      <td>6.7</td>
      <td>7.5</td>
      <td>3.2</td>
      <td>2.1</td>
      <td>10.4</td>
      <td>2.3</td>
      <td>3.1</td>
      <td>3.0</td>
      <td>4.9</td>
      <td>7.3</td>
      <td>3.7</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-be2e5d9a-a4de-472c-8e38-a7248c891d28')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-be2e5d9a-a4de-472c-8e38-a7248c891d28 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-be2e5d9a-a4de-472c-8e38-a7248c891d28');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-51671367-9262-4b69-b652-323455225c2d">
  <button class="colab-df-quickchart" onclick="quickchart('df-51671367-9262-4b69-b652-323455225c2d')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-51671367-9262-4b69-b652-323455225c2d button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>
</div></div>
</div>
<p>The two splits are clearly not equally representative. To make the splits equally representative, you can shuffle the data.</p>
<p>Run the following code cell to shuffle the data, and then recreate the features and labels from the shuffled data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Shuffle data</span>
<span class="n">wineDf</span> <span class="o">=</span> <span class="n">wineDf</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Recreate features and labels</span>
<span class="n">wineFeatures</span> <span class="o">=</span> <span class="n">wineDf</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">wineFeatures</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;quality&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">wineLabels</span> <span class="o">=</span> <span class="n">wineDf</span><span class="p">[</span><span class="s1">&#39;quality&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, confirm that the splits are equally representative by regenerating and comparing the statistics using the previous code cells. You may wonder why the initial splits differed so greatly. It turns out that in the wine dataset, the first 4897 rows contain data on white wines and the next 1599 rows contain data on red wines. When you split your dataset 80:20, then your training dataset contains 5197 examples, which is 94% white wine. The validation dataset is purely red wine.</p>
<p>Ensuring your splits are statistically equivalent is a good development practice. In general, following good development practices will simplify your model debugging. To learn about testing for statistical equivalence, see <a class="reference external" href="https://journals.sagepub.com/doi/10.1177/1948550617697177">Equivalence Tests Lakens, D.</a>.</p>
</section>
<section id="establish-a-baseline">
<h2><span class="section-number">11.7. </span>Establish a Baseline<a class="headerlink" href="#establish-a-baseline" title="Link to this heading">#</a></h2>
<p>For a regression problem, the simplest baseline to predict the average value. Run the following code to calculate the mean-squared error (MSE) loss on the training split using the average value as a baseline. Your loss is approximately 0.75. Any model should beat this loss to justify its use.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">baselineMSE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">wineLabels</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">splitIdx</span><span class="p">]</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wineLabels</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">splitIdx</span><span class="p">]))</span>
<span class="n">baselineMSE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">baselineMSE</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">baselineMSE</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">baselineMSE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.7738266430037695
</pre></div>
</div>
</div>
</div>
</section>
<section id="linear-model">
<h2><span class="section-number">11.8. </span>Linear Model<a class="headerlink" href="#linear-model" title="Link to this heading">#</a></h2>
<p>Following good ML dev practice, let’s start with a linear model that uses the most informative feature from the correlation matrix: <code class="docutils literal notranslate"><span class="pre">alcohol</span></code>. Even if this model performs badly, we can still use it as a baseline. This model should beat our previous baseline’s MSE of 0.75.</p>
<p>First, let’s define a function to plot our loss and accuracy curves. The function will also print the final loss and accuracy. Instead of using <code class="docutils literal notranslate"><span class="pre">verbose=1</span></code>, you can call the function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">showRegressionResults</span><span class="p">(</span><span class="n">trainHistory</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;Function to:</span>
<span class="sd">   * Print final loss.</span>
<span class="sd">   * Plot loss curves.</span>

<span class="sd">  Args:</span>
<span class="sd">    trainHistory: object returned by model.fit</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="c1"># Print final loss</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Final training loss: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">trainHistory</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Final Validation loss: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">trainHistory</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_loss&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

  <span class="c1"># Plot loss curves</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">trainHistory</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">])</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">trainHistory</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_loss&#39;</span><span class="p">])</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Training loss&#39;</span><span class="p">,</span><span class="s1">&#39;Validation loss&#39;</span><span class="p">],</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Loss Curves&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>For fast prototyping, let’s try using a full batch per epoch to update the gradient only once per  epoch. Use the full batch by setting <code class="docutils literal notranslate"><span class="pre">batch_size</span> <span class="pre">=</span> <span class="pre">wineFeatures.shape[0]</span></code> as indicated by the code comment.</p>
<p>What do you think of the loss curve? Can you improve it? For hints and discussion, see the following text cells.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
<span class="c1"># Choose feature</span>
<span class="n">wineFeaturesSimple</span> <span class="o">=</span> <span class="n">wineFeatures</span><span class="p">[</span><span class="s1">&#39;alcohol&#39;</span><span class="p">]</span>
<span class="c1"># Define model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">input_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="c1"># Specify the optimizer using the TF API to specify the learning rate</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
              <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">)</span>
<span class="c1"># Train the model!</span>
<span class="n">trainHistory</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">wineFeaturesSimple</span><span class="p">,</span>
                         <span class="n">wineLabels</span><span class="p">,</span>
                         <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                         <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>  <span class="c1"># Replace with your desired batch size</span>
                         <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                         <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Plot</span>
<span class="n">showRegressionResults</span><span class="p">(</span><span class="n">trainHistory</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Final training loss: 0.6339302659034729
Final Validation loss: 0.5759974718093872
</pre></div>
</div>
<img alt="../../_images/94fd0c563c65ffcca3a7a722ca139b8bf329ca08b891c8ae8468684610c6550f.png" src="../../_images/94fd0c563c65ffcca3a7a722ca139b8bf329ca08b891c8ae8468684610c6550f.png" />
</div>
</div>
<section id="hint">
<h3><span class="section-number">11.8.1. </span>Hint<a class="headerlink" href="#hint" title="Link to this heading">#</a></h3>
<p>The loss decreases but very slowly. Possible fixes are:</p>
<ul class="simple">
<li><p>Increase number of epochs.</p></li>
<li><p>Increase learning rate.</p></li>
<li><p>Decrease batch size. A lower batch size can result in larger decrease in loss per epoch, under the assumption that the smaller batches stay representative of the overall data distribution.</p></li>
</ul>
<p>Play with these three parameters in the code above to decrease the loss.</p>
</section>
<section id="id1">
<h3><span class="section-number">11.8.2. </span>Solution<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>Run the following code cell to train the model using a reduced batch size of 100. Reducing the batch size leads to a greater decrease in loss per epoch. The minimum achievable loss is about 0.64. This is a significant increase over our baseline of 0.75.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
<span class="c1"># Choose feature</span>
<span class="n">wineFeaturesSimple</span> <span class="o">=</span> <span class="n">wineFeatures</span><span class="p">[</span><span class="s1">&#39;alcohol&#39;</span><span class="p">]</span>
<span class="c1"># Define model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">input_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="c1"># Specify the optimizer using the TF API to specify the learning rate</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
              <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">)</span>
<span class="c1"># Train the model!</span>
<span class="n">trainHistory</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">wineFeaturesSimple</span><span class="p">,</span>
                         <span class="n">wineLabels</span><span class="p">,</span>
                         <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                         <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="c1"># set batch size here</span>
                         <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                         <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Plot</span>
<span class="n">showRegressionResults</span><span class="p">(</span><span class="n">trainHistory</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Final training loss: 0.6591692566871643
Final Validation loss: 0.5836994051933289
</pre></div>
</div>
<img alt="../../_images/1ad4e2d343167dc390688096a8cee2c718ca865af09d7d2f1ec590cea968c4a3.png" src="../../_images/1ad4e2d343167dc390688096a8cee2c718ca865af09d7d2f1ec590cea968c4a3.png" />
</div>
</div>
</section>
</section>
<section id="add-feature-to-linear-model">
<h2><span class="section-number">11.9. </span>Add Feature to Linear Model<a class="headerlink" href="#add-feature-to-linear-model" title="Link to this heading">#</a></h2>
<p>Try adding a feature to the linear model. Since you need to combine the two features into one prediction for regression, you’ll also need to add a second layer. Modify the code below to implement the following changes:</p>
<ol class="arabic simple">
<li><p>Add <code class="docutils literal notranslate"><span class="pre">'volatile</span> <span class="pre">acidity'</span></code> to the features in <code class="docutils literal notranslate"><span class="pre">wineFeaturesSimple</span></code>.</p></li>
<li><p>Add a second linear layer with 1 unit.</p></li>
<li><p>Experiment with learning rate, epochs, and batch_size to try to reduce loss.</p></li>
</ol>
<p>What happens to your loss?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
<span class="c1"># Select features</span>
<span class="n">wineFeaturesSimple</span> <span class="o">=</span> <span class="n">wineFeatures</span><span class="p">[[</span><span class="s1">&#39;alcohol&#39;</span><span class="p">,</span> <span class="s1">&#39;volatile acidity&#39;</span><span class="p">]]</span>  <span class="c1"># Add other features as needed</span>
<span class="c1"># Define model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">wineFeaturesSimple</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">input_dim</span><span class="o">=</span><span class="n">wineFeaturesSimple</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">))</span>

<span class="c1"># Compile</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>  <span class="c1"># Replace with your desired learning rate</span>
              <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">)</span>
<span class="c1"># Train</span>
<span class="n">trainHistory</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">wineFeaturesSimple</span><span class="p">,</span>
                         <span class="n">wineLabels</span><span class="p">,</span>
                         <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>  <span class="c1"># Replace with your desired number of epochs</span>
                         <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>  <span class="c1"># Replace with your desired batch size</span>
                         <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                         <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Plot results</span>
<span class="n">showRegressionResults</span><span class="p">(</span><span class="n">trainHistory</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Final training loss: 0.5843960046768188
Final Validation loss: 0.5128785371780396
</pre></div>
</div>
<img alt="../../_images/a45e728a3ecf5ae74f23318ab444de4bef9758b0fdf862e11a8b5f83dc3078aa.png" src="../../_images/a45e728a3ecf5ae74f23318ab444de4bef9758b0fdf862e11a8b5f83dc3078aa.png" />
</div>
</div>
<section id="id2">
<h3><span class="section-number">11.9.1. </span>Solution<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<p>Run the following code to add the second feature and the second layer. The training loss is about 0.59, a small decrease from the previous loss of 0.64.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
<span class="c1"># Select features</span>
<span class="n">wineFeaturesSimple</span> <span class="o">=</span> <span class="n">wineFeatures</span><span class="p">[[</span><span class="s1">&#39;alcohol&#39;</span><span class="p">,</span> <span class="s1">&#39;volatile acidity&#39;</span><span class="p">]]</span> <span class="c1"># add second feature</span>
<span class="c1"># Define model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">wineFeaturesSimple</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">input_dim</span><span class="o">=</span><span class="n">wineFeaturesSimple</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">))</span> <span class="c1"># add second layer</span>
<span class="c1"># Compile</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">)</span>
<span class="c1"># Train</span>
<span class="n">trainHistory</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">wineFeaturesSimple</span><span class="p">,</span>
                         <span class="n">wineLabels</span><span class="p">,</span>
                         <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                         <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                         <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                         <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Plot results</span>
<span class="n">showRegressionResults</span><span class="p">(</span><span class="n">trainHistory</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Final training loss: 0.5994521975517273
Final Validation loss: 0.5335853695869446
</pre></div>
</div>
<img alt="../../_images/3cd298737e0260b04083fc446e962206da9933e0ffd8c51c369a9ceb39747625.png" src="../../_images/3cd298737e0260b04083fc446e962206da9933e0ffd8c51c369a9ceb39747625.png" />
</div>
</div>
</section>
</section>
<section id="use-a-nonlinear-model">
<h2><span class="section-number">11.10. </span>Use a Nonlinear Model<a class="headerlink" href="#use-a-nonlinear-model" title="Link to this heading">#</a></h2>
<p>Let’s try a nonlinear model. Modify the code below to make the following changes:</p>
<ol class="arabic simple">
<li><p>Change the first layer to use <code class="docutils literal notranslate"><span class="pre">relu</span></code>. (Output layer stays linear since this is a regression problem.)</p></li>
<li><p>As usual, specify the learning rate, epochs, and batch_size.</p></li>
</ol>
<p>Run the cell. Does the loss increase, decrease, or stay the same?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
<span class="c1"># Define</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">wineFeaturesSimple</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">input_dim</span><span class="o">=</span><span class="n">wineFeaturesSimple</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>  <span class="c1"># Replace &#39;relu&#39; with your desired activation function</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">))</span>
<span class="c1"># Compile</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">)</span>
<span class="c1"># Fit</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">wineFeaturesSimple</span><span class="p">,</span>
          <span class="n">wineLabels</span><span class="p">,</span>
          <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>  <span class="c1"># Replace with your desired number of epochs</span>
          <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>  <span class="c1"># Replace with your desired batch size</span>
          <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
          <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Plot results</span>
<span class="n">showRegressionResults</span><span class="p">(</span><span class="n">trainHistory</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Final training loss: 0.5843960046768188
Final Validation loss: 0.5128785371780396
</pre></div>
</div>
<img alt="../../_images/a45e728a3ecf5ae74f23318ab444de4bef9758b0fdf862e11a8b5f83dc3078aa.png" src="../../_images/a45e728a3ecf5ae74f23318ab444de4bef9758b0fdf862e11a8b5f83dc3078aa.png" />
</div>
</div>
<section id="id3">
<h3><span class="section-number">11.10.1. </span>Solution<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<p>Run the following cell to use a <code class="docutils literal notranslate"><span class="pre">relu</span></code> activation in your first hidden layer. Your loss stays about the same, perhaps declining negligibly to 0.58.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
<span class="c1"># Define</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">wineFeaturesSimple</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">input_dim</span><span class="o">=</span><span class="n">wineFeaturesSimple</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">))</span>
<span class="c1"># Compile</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">)</span>
<span class="c1"># Fit</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">wineFeaturesSimple</span><span class="p">,</span>
          <span class="n">wineLabels</span><span class="p">,</span>
          <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
          <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
          <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
          <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Plot results</span>
<span class="n">showRegressionResults</span><span class="p">(</span><span class="n">trainHistory</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Final training loss: 0.5843960046768188
Final Validation loss: 0.5128785371780396
</pre></div>
</div>
<img alt="../../_images/a45e728a3ecf5ae74f23318ab444de4bef9758b0fdf862e11a8b5f83dc3078aa.png" src="../../_images/a45e728a3ecf5ae74f23318ab444de4bef9758b0fdf862e11a8b5f83dc3078aa.png" />
</div>
</div>
</section>
</section>
<section id="optimize-your-model">
<h2><span class="section-number">11.11. </span>Optimize Your Model<a class="headerlink" href="#optimize-your-model" title="Link to this heading">#</a></h2>
<p>We have two features with one hidden layer but didn’t see an improvement. At this point, it’s tempting to use all your features with a high-capacity network. However, you must resist the temptation. Instead, follow the guidance in <a class="reference external" href="https://developers.google.com/machine-learning/testing-debugging/common/optimization">Model Optimization</a> to improve model performance. For a hint and for a discussion, see the following text sections.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Choose features</span>
<span class="n">wineFeaturesSimple</span> <span class="o">=</span> <span class="n">wineFeatures</span><span class="p">[[</span><span class="s1">&#39;alcohol&#39;</span><span class="p">,</span> <span class="s1">&#39;volatile acidity&#39;</span><span class="p">]]</span> <span class="c1"># add features</span>

<span class="c1"># Define</span>
<span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">wineFeaturesSimple</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span>
                             <span class="n">input_dim</span><span class="o">=</span><span class="n">wineFeaturesSimple</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

<span class="c1"># Add more layers here</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">))</span>

<span class="c1"># Compile</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">)</span>

<span class="c1"># Train</span>
<span class="n">trainHistory</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">wineFeaturesSimple</span><span class="p">,</span>
                         <span class="n">wineLabels</span><span class="p">,</span>
                         <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>  <span class="c1"># Replace with your desired number of epochs</span>
                         <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>  <span class="c1"># Replace with your desired batch size</span>
                         <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                         <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Plot results</span>
<span class="n">showRegressionResults</span><span class="p">(</span><span class="n">trainHistory</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Final training loss: 0.7648102045059204
Final Validation loss: 0.7018823027610779
</pre></div>
</div>
<img alt="../../_images/fda3fb36a03fdb0d294b3ebaa4d23553b5e9d6a0a88d0b7afd8f135d0099e3e9.png" src="../../_images/fda3fb36a03fdb0d294b3ebaa4d23553b5e9d6a0a88d0b7afd8f135d0099e3e9.png" />
</div>
</div>
<section id="id4">
<h3><span class="section-number">11.11.1. </span>Hint<a class="headerlink" href="#id4" title="Link to this heading">#</a></h3>
<p>You can try to reduce loss by adding features, adding layers, or playing with the hyperparameters. Before adding more features, check the correlation matrix. Don’t expect your loss to decrease by much. Sadly, that is a common experience in machine learning!</p>
</section>
<section id="id5">
<h3><span class="section-number">11.11.2. </span>Solution<a class="headerlink" href="#id5" title="Link to this heading">#</a></h3>
<p>Run the following code to:</p>
<ul class="simple">
<li><p>Add the features chlorides and density.</p></li>
<li><p>Set training epochs to 100.</p></li>
<li><p>Set batch size to 100.</p></li>
</ul>
<p>Your loss reduces to about 0.56. That’s a minor improvement over the previous loss of 0.58. It seems that adding more features or capacity isn’t improving your model by much. Perhaps your model has a bug? In the next section, you will run a sanity check on your model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Choose features</span>
<span class="n">wineFeaturesSimple</span> <span class="o">=</span> <span class="n">wineFeatures</span><span class="p">[[</span><span class="s1">&#39;alcohol&#39;</span><span class="p">,</span><span class="s1">&#39;volatile acidity&#39;</span><span class="p">,</span><span class="s1">&#39;chlorides&#39;</span><span class="p">,</span><span class="s1">&#39;density&#39;</span><span class="p">]]</span>
<span class="c1"># Define</span>
<span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">wineFeaturesSimple</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span>
                             <span class="n">input_dim</span><span class="o">=</span><span class="n">wineFeaturesSimple</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="c1"># Add more layers here</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">))</span>
<span class="c1"># Compile</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">)</span>
<span class="c1"># Train</span>
<span class="n">trainHistory</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">wineFeaturesSimple</span><span class="p">,</span>
                         <span class="n">wineLabels</span><span class="p">,</span>
                         <span class="n">epochs</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                         <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                         <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                         <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Plot results</span>
<span class="n">showRegressionResults</span><span class="p">(</span><span class="n">trainHistory</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Final training loss: 0.5778111219406128
Final Validation loss: 0.51249098777771
</pre></div>
</div>
<img alt="../../_images/be09d4b57390221b15635d12f058ff37fa23a40b128a50577bfdd5ad26b9ebb2.png" src="../../_images/be09d4b57390221b15635d12f058ff37fa23a40b128a50577bfdd5ad26b9ebb2.png" />
</div>
</div>
</section>
</section>
<section id="check-for-implementation-bugs-using-reduced-dataset">
<h2><span class="section-number">11.12. </span>Check for Implementation Bugs using Reduced Dataset<a class="headerlink" href="#check-for-implementation-bugs-using-reduced-dataset" title="Link to this heading">#</a></h2>
<p>Your loss isn’t decreasing by much. Perhaps your model has an implementation bug. From the <a class="reference external" href="https://developers.google.com/machine-learning/testing-debugging/common/model-errors">Model Debugging</a> guidelines, a quick test for implementation bugs is to obtain a low loss on a reduced dataset of, say, 10 examples. Remember, passing this test does not validate your modeling approach but only checks for basic implementation bugs. In your ML problem, if your model passes this test, then continue debugging your model to train on your full dataset.</p>
<p>In the following code, experiment with the learning rate, batch size, and number of epochs. Can you reach a low loss? Choose hyperparameter values that let you iterate quickly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Choose 10 examples</span>
<span class="n">wineFeaturesSmall</span> <span class="o">=</span> <span class="n">wineFeatures</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
<span class="n">wineLabelsSmall</span> <span class="o">=</span> <span class="n">wineLabels</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>

<span class="c1"># Define model</span>
<span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">wineFeaturesSmall</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span>
                             <span class="n">input_dim</span><span class="o">=</span><span class="n">wineFeaturesSmall</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">wineFeaturesSmall</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">))</span>

<span class="c1"># Compile</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">)</span>  <span class="c1"># Set learning rate</span>

<span class="c1"># Train</span>
<span class="n">trainHistory</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">wineFeaturesSmall</span><span class="p">,</span>
                        <span class="n">wineLabelsSmall</span><span class="p">,</span>
                        <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>  <span class="c1"># Replace with your desired number of epochs</span>
                        <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>  <span class="c1"># Replace with your desired batch size</span>
                        <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Plot results</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Final training loss: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">trainHistory</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">trainHistory</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Final training loss: 11.7090482711792
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7e3d355e1e70&gt;]
</pre></div>
</div>
<img alt="../../_images/dd3b1a0fb2895b744aea729349c1d92dbe825f68ff5e2e0dd7a949447453f8d9.png" src="../../_images/dd3b1a0fb2895b744aea729349c1d92dbe825f68ff5e2e0dd7a949447453f8d9.png" />
</div>
</div>
<section id="id6">
<h3><span class="section-number">11.12.1. </span>Solution<a class="headerlink" href="#id6" title="Link to this heading">#</a></h3>
<p>Run the following code cell to train the model using these hyperparameter values:</p>
<ul class="simple">
<li><p>learning rate = 0.01</p></li>
<li><p>epochs = 200</p></li>
<li><p>batch size = 10</p></li>
</ul>
<p>You get a low loss on your reduced dataset. This result means your model is probably solid and your previous results are as good as they’ll get.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Choose 10 examples</span>
<span class="n">wineFeaturesSmall</span> <span class="o">=</span> <span class="n">wineFeatures</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
<span class="n">wineLabelsSmall</span> <span class="o">=</span> <span class="n">wineLabels</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
<span class="c1"># Define model</span>
<span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">wineFeaturesSmall</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span>
                             <span class="n">input_dim</span><span class="o">=</span><span class="n">wineFeaturesSmall</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">wineFeaturesSmall</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">))</span>
<span class="c1"># Compile</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="mf">0.01</span><span class="p">),</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">)</span> <span class="c1"># set LR</span>
<span class="c1"># Train</span>
<span class="n">trainHistory</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">wineFeaturesSmall</span><span class="p">,</span>
                        <span class="n">wineLabelsSmall</span><span class="p">,</span>
                        <span class="n">epochs</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                        <span class="n">batch_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                        <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Plot results</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Final training loss: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">trainHistory</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">trainHistory</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Final training loss: 0.33318591117858887
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7e3d441045e0&gt;]
</pre></div>
</div>
<img alt="../../_images/8ea89410c54ec486b48b665a5abb254555b82ffe384400e5511bbc68b673d56f.png" src="../../_images/8ea89410c54ec486b48b665a5abb254555b82ffe384400e5511bbc68b673d56f.png" />
</div>
</div>
</section>
</section>
<section id="trying-a-very-complex-model">
<h2><span class="section-number">11.13. </span>Trying a Very Complex Model<a class="headerlink" href="#trying-a-very-complex-model" title="Link to this heading">#</a></h2>
<p>Let’s go all in and use a very complex model with all the features. For science! And to satisfy ourselves that a simple model is indeed better. Let’s use all 11 features with 3 fully-connected relu layers and a final linear layer. The next cell takes a while to run. Skip to the results in the cell after if you like.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
<span class="c1"># Define</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">wineFeatures</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span>
                             <span class="n">input_dim</span><span class="o">=</span><span class="n">wineFeatures</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">wineFeatures</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">wineFeatures</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">))</span>
<span class="c1"># Compile</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">)</span>
<span class="c1"># Train the model!</span>
<span class="n">trainHistory</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">wineFeatures</span><span class="p">,</span> <span class="n">wineLabels</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                         <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">validation_split</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="c1"># Plot results</span>
<span class="n">showRegressionResults</span><span class="p">(</span><span class="n">trainHistory</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/100
52/52 [==============================] - 1s 8ms/step - loss: 10.1107 - val_loss: 5.9102
Epoch 2/100
52/52 [==============================] - 0s 4ms/step - loss: 5.0580 - val_loss: 4.2809
Epoch 3/100
52/52 [==============================] - 0s 4ms/step - loss: 3.0781 - val_loss: 1.6974
Epoch 4/100
52/52 [==============================] - 0s 5ms/step - loss: 1.5744 - val_loss: 1.0843
Epoch 5/100
52/52 [==============================] - 0s 5ms/step - loss: 1.1691 - val_loss: 0.8313
Epoch 6/100
52/52 [==============================] - 0s 5ms/step - loss: 0.9342 - val_loss: 0.7203
Epoch 7/100
52/52 [==============================] - 0s 3ms/step - loss: 0.8001 - val_loss: 0.6452
Epoch 8/100
52/52 [==============================] - 0s 3ms/step - loss: 0.7394 - val_loss: 0.5998
Epoch 9/100
52/52 [==============================] - 0s 3ms/step - loss: 0.6811 - val_loss: 0.5844
Epoch 10/100
52/52 [==============================] - 0s 2ms/step - loss: 0.6714 - val_loss: 0.5682
Epoch 11/100
52/52 [==============================] - 0s 3ms/step - loss: 0.6571 - val_loss: 0.5636
Epoch 12/100
52/52 [==============================] - 0s 3ms/step - loss: 0.6560 - val_loss: 0.5587
Epoch 13/100
52/52 [==============================] - 0s 3ms/step - loss: 0.6351 - val_loss: 0.5630
Epoch 14/100
52/52 [==============================] - 0s 3ms/step - loss: 0.6233 - val_loss: 0.5414
Epoch 15/100
52/52 [==============================] - 0s 3ms/step - loss: 0.6215 - val_loss: 0.5577
Epoch 16/100
52/52 [==============================] - 0s 3ms/step - loss: 0.6176 - val_loss: 0.5470
Epoch 17/100
52/52 [==============================] - 0s 3ms/step - loss: 0.6180 - val_loss: 0.5335
Epoch 18/100
52/52 [==============================] - 0s 3ms/step - loss: 0.6123 - val_loss: 0.5459
Epoch 19/100
52/52 [==============================] - 0s 3ms/step - loss: 0.6090 - val_loss: 0.5325
Epoch 20/100
52/52 [==============================] - 0s 3ms/step - loss: 0.6000 - val_loss: 0.5298
Epoch 21/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5983 - val_loss: 0.5214
Epoch 22/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5977 - val_loss: 0.5245
Epoch 23/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5999 - val_loss: 0.5583
Epoch 24/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5969 - val_loss: 0.5317
Epoch 25/100
52/52 [==============================] - 0s 2ms/step - loss: 0.6043 - val_loss: 0.5147
Epoch 26/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5909 - val_loss: 0.5159
Epoch 27/100
52/52 [==============================] - 0s 2ms/step - loss: 0.5897 - val_loss: 0.5121
Epoch 28/100
52/52 [==============================] - 0s 2ms/step - loss: 0.5932 - val_loss: 0.5663
Epoch 29/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5919 - val_loss: 0.5229
Epoch 30/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5835 - val_loss: 0.5169
Epoch 31/100
52/52 [==============================] - 0s 2ms/step - loss: 0.5797 - val_loss: 0.5089
Epoch 32/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5781 - val_loss: 0.5065
Epoch 33/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5766 - val_loss: 0.5060
Epoch 34/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5791 - val_loss: 0.5149
Epoch 35/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5989 - val_loss: 0.5289
Epoch 36/100
52/52 [==============================] - 0s 3ms/step - loss: 0.6003 - val_loss: 0.5356
Epoch 37/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5821 - val_loss: 0.5042
Epoch 38/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5719 - val_loss: 0.5030
Epoch 39/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5781 - val_loss: 0.5014
Epoch 40/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5758 - val_loss: 0.5395
Epoch 41/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5741 - val_loss: 0.5062
Epoch 42/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5726 - val_loss: 0.5127
Epoch 43/100
52/52 [==============================] - 0s 2ms/step - loss: 0.5683 - val_loss: 0.5002
Epoch 44/100
52/52 [==============================] - 0s 2ms/step - loss: 0.5734 - val_loss: 0.5106
Epoch 45/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5713 - val_loss: 0.5118
Epoch 46/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5906 - val_loss: 0.4978
Epoch 47/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5761 - val_loss: 0.5143
Epoch 48/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5636 - val_loss: 0.5006
Epoch 49/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5736 - val_loss: 0.5068
Epoch 50/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5643 - val_loss: 0.5086
Epoch 51/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5614 - val_loss: 0.4964
Epoch 52/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5792 - val_loss: 0.4966
Epoch 53/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5697 - val_loss: 0.5660
Epoch 54/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5816 - val_loss: 0.4941
Epoch 55/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5679 - val_loss: 0.5029
Epoch 56/100
52/52 [==============================] - 0s 2ms/step - loss: 0.5675 - val_loss: 0.4994
Epoch 57/100
52/52 [==============================] - 0s 2ms/step - loss: 0.5618 - val_loss: 0.4932
Epoch 58/100
52/52 [==============================] - 0s 2ms/step - loss: 0.5676 - val_loss: 0.4896
Epoch 59/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5602 - val_loss: 0.4893
Epoch 60/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5555 - val_loss: 0.5295
Epoch 61/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5677 - val_loss: 0.5429
Epoch 62/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5622 - val_loss: 0.4897
Epoch 63/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5732 - val_loss: 0.4886
Epoch 64/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5670 - val_loss: 0.4880
Epoch 65/100
52/52 [==============================] - 0s 2ms/step - loss: 0.5759 - val_loss: 0.4933
Epoch 66/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5702 - val_loss: 0.5184
Epoch 67/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5570 - val_loss: 0.4869
Epoch 68/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5545 - val_loss: 0.4860
Epoch 69/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5596 - val_loss: 0.4951
Epoch 70/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5811 - val_loss: 0.5845
Epoch 71/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5685 - val_loss: 0.4868
Epoch 72/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5553 - val_loss: 0.4904
Epoch 73/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5569 - val_loss: 0.4846
Epoch 74/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5619 - val_loss: 0.4842
Epoch 75/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5606 - val_loss: 0.4840
Epoch 76/100
52/52 [==============================] - 0s 4ms/step - loss: 0.5609 - val_loss: 0.5185
Epoch 77/100
52/52 [==============================] - 0s 4ms/step - loss: 0.5972 - val_loss: 0.4855
Epoch 78/100
52/52 [==============================] - 0s 4ms/step - loss: 0.5677 - val_loss: 0.4825
Epoch 79/100
52/52 [==============================] - 0s 4ms/step - loss: 0.5563 - val_loss: 0.4875
Epoch 80/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5526 - val_loss: 0.4960
Epoch 81/100
52/52 [==============================] - 0s 4ms/step - loss: 0.5552 - val_loss: 0.5070
Epoch 82/100
52/52 [==============================] - 0s 4ms/step - loss: 0.5535 - val_loss: 0.4903
Epoch 83/100
52/52 [==============================] - 0s 4ms/step - loss: 0.5566 - val_loss: 0.5203
Epoch 84/100
52/52 [==============================] - 0s 4ms/step - loss: 0.5538 - val_loss: 0.4860
Epoch 85/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5700 - val_loss: 0.5153
Epoch 86/100
52/52 [==============================] - 0s 4ms/step - loss: 0.5555 - val_loss: 0.4886
Epoch 87/100
52/52 [==============================] - 0s 4ms/step - loss: 0.5510 - val_loss: 0.4816
Epoch 88/100
52/52 [==============================] - 0s 4ms/step - loss: 0.5529 - val_loss: 0.4927
Epoch 89/100
52/52 [==============================] - 0s 4ms/step - loss: 0.5492 - val_loss: 0.4852
Epoch 90/100
52/52 [==============================] - 0s 4ms/step - loss: 0.5496 - val_loss: 0.4937
Epoch 91/100
52/52 [==============================] - 0s 4ms/step - loss: 0.5633 - val_loss: 0.4809
Epoch 92/100
52/52 [==============================] - 0s 4ms/step - loss: 0.5701 - val_loss: 0.5083
Epoch 93/100
52/52 [==============================] - 0s 4ms/step - loss: 0.5765 - val_loss: 0.5725
Epoch 94/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5581 - val_loss: 0.4898
Epoch 95/100
52/52 [==============================] - 0s 2ms/step - loss: 0.5595 - val_loss: 0.5327
Epoch 96/100
52/52 [==============================] - 0s 2ms/step - loss: 0.5616 - val_loss: 0.5250
Epoch 97/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5724 - val_loss: 0.4854
Epoch 98/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5451 - val_loss: 0.5053
Epoch 99/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5511 - val_loss: 0.5023
Epoch 100/100
52/52 [==============================] - 0s 3ms/step - loss: 0.5540 - val_loss: 0.4844
Final training loss: 0.5540224313735962
Final Validation loss: 0.48444509506225586
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.4, 1.0)
</pre></div>
</div>
<img alt="../../_images/3aa211eed4fa2cb49c87c6d9bac99597b8a06a1da7bf57db060247452f3f86d0.png" src="../../_images/3aa211eed4fa2cb49c87c6d9bac99597b8a06a1da7bf57db060247452f3f86d0.png" />
</div>
</div>
<section id="results">
<h3><span class="section-number">11.13.1. </span>Results<a class="headerlink" href="#results" title="Link to this heading">#</a></h3>
<p>If you train for long enough, the minimum achievable MSE is around 0.52, which is a decrease of 0.04 from the previous best loss of 0.56. This decrease probably isn’t worth the performance and complexity cost of using all your features and a deeper network. However, that decision depends on the objectives you’re optimizing for.</p>
<p>If you train the model long enough, the validation loss actually starts increasing while training loss continues to decrease. This divergence in loss curves means your model is overfitting. The overfitting results from the closer fit that your very complex model can learn. Stick with the simpler model. You’ll be happier and live longer!</p>
<p>If you do want to optimize your loss, then play with the model to find the minimum achievable training loss before overfitting sets in. Try playing with the network parameters in the code cell above to achieve a loss of 0.51. But be warned—optimizing your loss could take a lot of trial and error..</p>
</section>
</section>
<section id="conclusion">
<h2><span class="section-number">11.14. </span>Conclusion<a class="headerlink" href="#conclusion" title="Link to this heading">#</a></h2>
<p>This Colab demonstrated the following principles:</p>
<ul class="simple">
<li><p>The most important step in machine learning is understanding your data.</p></li>
<li><p>The largest gains come from the initial features and network.</p></li>
<li><p>Returns diminish as you add features and complexity.</p></li>
<li><p>Incremental development provides confidence in model quality and allows benchmarking against previous results.</p></li>
<li><p>Reproducing previous results is extremely important. Hence, always use version control.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./book/assignments"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="debugging-in-classification.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">10. </span>Case Study: Debugging in Classification</p>
      </div>
    </a>
    <a class="right-next"
       href="random-forest-classifier.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">12. </span>Introduction</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">11.1. Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#check-correlation-matrix">11.2. Check Correlation Matrix</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#validate-input-data-against-data-schema">11.3. Validate Input Data against Data Schema</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#solution">11.3.1. Solution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#split-and-normalize-data">11.4. Split and Normalize Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-engineered-data">11.5. Test Engineered Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#check-splits-for-statistical-equivalence">11.6. Check Splits for Statistical Equivalence</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#establish-a-baseline">11.7. Establish a Baseline</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-model">11.8. Linear Model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hint">11.8.1. Hint</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">11.8.2. Solution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#add-feature-to-linear-model">11.9. Add Feature to Linear Model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">11.9.1. Solution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-a-nonlinear-model">11.10. Use a Nonlinear Model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">11.10.1. Solution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optimize-your-model">11.11. Optimize Your Model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">11.11.1. Hint</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">11.11.2. Solution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#check-for-implementation-bugs-using-reduced-dataset">11.12. Check for Implementation Bugs using Reduced Dataset</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">11.12.1. Solution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#trying-a-very-complex-model">11.13. Trying a Very Complex Model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#results">11.13.1. Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">11.14. Conclusion</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Xu Mingrui
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>